<!DOCTYPE html>
<html lang="en">
<head>
    <title>Finance Analysis ‚Äì CostScope</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            background: #080710;
            font-family: 'Poppins', sans-serif;
            color: white;
            text-align: center;
            padding: 2rem;
        }
        canvas {
            margin-top: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            max-width: 100%;
            height: auto;
        }
        a {
            display: block;
            margin-top: 2rem;
            color: #a2c8ff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <h1>Spending Breakdown by Category</h1>

    <canvas id="categoryChart" width="400" height="400"></canvas>

    <a href="{{ url_for('main.home') }}">‚Üê Back to Home</a>

    <script>
        // Safely handle empty data
        const chartLabels = {{ labels | safe }} || [];
        const chartValues = {{ values | safe }} || [];

        if (chartLabels.length === 0 || chartValues.length === 0) {
            document.getElementById('categoryChart').style.display = 'none';
            document.body.insertAdjacentHTML('beforeend', '<p>No data available to display.</p>');
        } else {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Spending by Category',
                        data: chartValues,
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                            '#9966FF', '#FF9F40', '#5A9', '#DB4437',
                            '#0F9D58', '#AB47BC', '#F4B400', '#00ACC1'
                        ],
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }
    </script>

    <h2 style="margin-top: 3rem;">üìÖ Total Monthly Spending</h2>
    <canvas id="monthlyChart" width="500" height="300"></canvas>

    <script>
        // Use data from Python
        const months = {{ months | safe }};
        const monthlyTotals = {{ monthly_totals | safe }};

        const ctxLine = document.getElementById('monthlyChart').getContext('2d');
        new Chart(ctxLine, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'Total Spending ($)',
                    data: monthlyTotals,
                    borderColor: '#36A2EB',
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                scales: {
                    x: { ticks: { color: 'white' } },
                    y: { ticks: { color: 'white' } }
                },
                plugins: {
                    legend: { labels: { color: 'white' } }
                }
            }
        });
    </script>

    <h2 style="margin-top: 3rem;">üî• Top 3 Spending Categories</h2>
    <canvas id="topChart" width="500" height="300"></canvas>

    <script>
        const topLabels = {{ top_labels | safe }};
        const topValues = {{ top_values | safe }};

        const ctxTop = document.getElementById('topChart').getContext('2d');
        new Chart(ctxTop, {
            type: 'bar',
            data: {
                labels: topLabels,
                datasets: [{
                    label: 'Amount Spent ($)',
                    data: topValues,
                    backgroundColor: ['#ff6b6b', '#ffa502', '#1e90ff']
                }]
            },
            options: {
                scales: {
                    x: { ticks: { color: 'white' } },
                    y: { ticks: { color: 'white' } }
                },
                plugins: {
                    legend: { labels: { color: 'white' } }
                }
            }
        });
    </script>

    <div style="margin-top: 1rem; color: #aaa;">
        {% if top_labels %}
        <p>üèÜ <strong>{{ top_labels[0] }}</strong> made up the largest share of your spending.</p>
        {% endif %}
    </div>

    <h2 style="margin-top: 3rem;">üìä Budget vs. Actual Spending</h2>
    <canvas id="budgetChart" width="500" height="300"></canvas>

    <script>
        const categories = {{ categories_for_budget | safe }};
        const actualData = {{ actual | safe }};
        const budgetData = {{ budget | safe }};

        const ctxBudget = document.getElementById('budgetChart').getContext('2d');
        new Chart(ctxBudget, {
            type: 'bar',
            data: {
                labels: categories,
                datasets: [
                    {
                        label: 'Actual Spending ($)',
                        data: actualData,
                        backgroundColor: '#36A2EB'
                    },
                    {
                        label: 'Budget ($)',
                        data: budgetData,
                        backgroundColor: '#ff6384'
                    }
                ]
            },
            options: {
                scales: {
                    x: { ticks: { color: 'white' } },
                    y: { ticks: { color: 'white' } }
                },
                plugins: {
                    legend: { labels: { color: 'white' } }
                }
            }
        });
    </script>

    <h2 style="margin-top: 3rem;">‚öñÔ∏è Needs vs Wants</h2>
    <canvas id="needsWantsChart" width="500" height="300"></canvas>

    <script>
        const needsWantsCtx = document.getElementById('needsWantsChart').getContext('2d');
        new Chart(needsWantsCtx, {
            type: 'pie',
            data: {
                labels: ['Needs', 'Wants'],
                datasets: [{
                    label: 'Spending Type',
                    data: [{{ needs_total }}, {{ wants_total }}],
                    backgroundColor: ['#2ecc71', '#e74c3c']
                }]
            },
            options: {
                plugins: {
                    legend: { labels: { color: 'white' } }
                }
            }
        });
    </script>






  
</body>
</html>