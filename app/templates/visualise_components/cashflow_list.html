<!-- templates/visualise_components/cashflow_list.html -->
<div class="bg-[#1e1e1e] p-6 rounded-xl border border-[#333] flex flex-col h-80">
  <!-- Bubble-Style Filter Pills -->
  <div class="flex flex-wrap gap-2 mb-4">
    <!-- Frequency -->
    <button type="button"
            class="filter-btn px-3 py-1 rounded-full bg-gray-700 text-gray-300 text-xs font-medium hover:bg-gray-600 focus:outline-none transition"
            data-filter-key="frequency"
            data-filter-val="Recurring">
      Recurring
    </button>
    <button type="button"
            class="filter-btn px-3 py-1 rounded-full bg-gray-700 text-gray-300 text-xs font-medium hover:bg-gray-600 focus:outline-none transition"
            data-filter-key="frequency"
            data-filter-val="Once-off">
      Once-off
    </button>

    <!-- Importance -->
    <button type="button"
            class="filter-btn px-3 py-1 rounded-full bg-gray-700 text-gray-300 text-xs font-medium hover:bg-gray-600 focus:outline-none transition"
            data-filter-key="importance"
            data-filter-val="Need">
      Need
    </button>
    <button type="button"
            class="filter-btn px-3 py-1 rounded-full bg-gray-700 text-gray-300 text-xs font-medium hover:bg-gray-600 focus:outline-none transition"
            data-filter-key="importance"
            data-filter-val="Want">
      Want
    </button>

    <!-- Clear -->
    <button id="clearFilters"
            type="button"
            class="ml-auto text-sm text-gray-400 hover:underline focus:outline-none">
      Clear
    </button>
  </div>

  <!-- Scrollable Breakdown List -->
  <ul id="breakdownList" class="flex-1 overflow-y-auto divide-y divide-[#333]">
    {% for tx in transactions %}
      <li class="py-2 flex justify-between items-center"
          data-frequency="{{ tx.tags.frequency }}"
          data-importance="{{ tx.tags.importance }}">
        <div class="space-y-0.5">
          <div class="font-medium">{{ tx.name }}</div>
          <div class="text-xs text-gray-500">{{ tx.type|capitalize }}</div>
        </div>
        <div class="font-semibold">${{ '%.2f'|format(tx.amount) }}</div>
      </li>
    {% else %}
      <li class="py-2 text-gray-500">No transactions to display.</li>
    {% endfor %}
  </ul>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const buttons = document.querySelectorAll('.filter-btn');
  const clearBtn = document.getElementById('clearFilters');

  // Attach toggle + fetch on each pill
  buttons.forEach(btn => btn.addEventListener('click', () => {
    const active = btn.classList.toggle('bg-blue-500');
    btn.classList.toggle('text-white', active);
    btn.classList.toggle('bg-gray-700', !active);
    btn.classList.toggle('text-gray-300', !active);
    fetchFiltered();
  }));

  // Clear all filters
  clearBtn.addEventListener('click', () => {
    buttons.forEach(b => {
      b.classList.remove('bg-blue-500','text-white');
      b.classList.add('bg-gray-700','text-gray-300');
    });
    fetchFiltered();
  });

  function fetchFiltered() {
    // gather active filters by key
    const active = Array.from(buttons).filter(b => b.classList.contains('bg-blue-500'));
    const freq = [...new Set(active
      .filter(b => b.dataset.filterKey === 'frequency')
      .map(b => b.dataset.filterVal))];
    const imp = [...new Set(active
      .filter(b => b.dataset.filterKey === 'importance')
      .map(b => b.dataset.filterVal))];

    // POST and inject updated <li>â€¦</li>
    fetch('{{ url_for("main.breakdown_list") }}', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ frequency: freq, importance: imp })
    })
    .then(r => r.text())
    .then(html => {
      document.getElementById('breakdownList').innerHTML = html;
    });
  }
});
</script>