<style type="text/tailwindcss">
    /* 1. Chart size */
    #cashFlowChart {
      width: 100% !important;
      height: 100% !important;
    }
  
  /* Inactive: hollow grey button */
  /* Hover on inactive: slightly darker warm grey */
  .mode-btn {
  background-color: transparent;
  color: #bbbbbb;             /* warm light grey text */
  border: 1px solid #555555;  /* warm medium border */
  border-radius: 0.5rem;    /* rounded-md */
  padding: 0.25rem 0.75rem;
  text-align: left;
  transition: all 0.2s ease;
}

/* Hover on inactive button */
.mode-btn:hover:not(.active) {
  background-color: #2a2a2a; /* slightly warm dark grey */
}

/* Active selected button */
.mode-btn.active {
  background-color: #333333; /* warm filled */
  color: white;
  border-color: #333333;
  border-radius: 0.5rem;     /* rounded-lg for softer edges */
}


  </style>
  
  <div class="bg-[#1e1e1e] p-6 rounded-xl border border-[#333] h-80 relative">
    <!-- Toggle Buttons -->
    <div class="absolute top-4 left-4 flex flex-col gap-2 z-10 min-w-max">
        
        <!-- Recurring vs Once-off -->
        <button
          id="frequencyToggle"
          class="mode-btn active flex justify-center items-center w-full px-3 py-1 text-xs"
        >
          Recurring vs Once-off
        </button>

        <!-- Need vs Want -->
        <button
          id="importanceToggle"
          class="mode-btn  flex justify-center items-center w-full px-3 py-1 text-xs"
        >
          Need vs Want
        </button>
      
      </div>
  
    <!-- Chart Canvas -->
    <canvas id="cashFlowChart"></canvas>
  
    <!-- Center Text -->
    <div
      id="cashFlowCenterText"
      class="absolute inset-0 flex items-center justify-center text-2xl font-bold text-white pointer-events-none"
    >
      $0
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // 1. Grab data from Flask
    const chartData   = JSON.parse('{{ chart_data|tojson|safe }}');
    const totalIncome = chartData.totalIncome;
  
    // 2. Prepare Importance data
    const impLabels = Object.keys(chartData.importanceTotals);
    const impData   = Object.values(chartData.importanceTotals);
    impLabels.push('Leftover');
    impData.push(chartData.importanceLeftover);
  
    // 3. Prepare Frequency data
    const freqLabels = Object.keys(chartData.frequencyTotals);
    const freqData   = Object.values(chartData.frequencyTotals);
    freqLabels.push('Leftover');
    freqData.push(chartData.frequencyLeftover);
  
    // 4. Set initial center text
    document.getElementById('cashFlowCenterText').textContent =
      `$${totalIncome.toFixed(2)}`;
  
    // 5. Initialize Chart.js
    const ctx = document.getElementById('cashFlowChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: impLabels,
        datasets: [{
          data: freqData,
          backgroundColor: ['#a855f733', '#60a5fa33', '#52525b33'],
          borderColor:     ['#a855f7',   '#60a5fa',   '#52525b'],
          borderWidth: 1
        }]
      },
      options: {
        cutout: '70%',
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        }
      }
    });
  
    // 6. Toggle logic
    const btnImp  = document.getElementById('importanceToggle');
    const btnFreq = document.getElementById('frequencyToggle');
    const freqColours = ['#a855f733', '#60a5fa33', '#52525b33'];
const impColours  = ['#f59e0b33', '#fcd34d33', '#52525b33'];
const freqBorder  = ['#a855f7', '#60a5fa', '#52525b'];
const impBorder   = ['#f59e0b', '#fcd34d', '#52525b'];


    function applyDataset(labels, data, colors) {
  chart.data.labels = [...labels];                        // clone to avoid mutation issues
  chart.data.datasets[0].data = [...data];                // clone to avoid corruption
  chart.data.datasets[0].backgroundColor = colors.slice(0, labels.length);
  chart.data.datasets[0].borderColor = colors.slice(0, labels.length);
  chart.update();
}
  
    btnImp.addEventListener('click', () => {
    if (btnImp.classList.contains('active')) return; // avoid redundant re-render
     btnImp.classList.add('active');
     btnFreq.classList.remove('active');
    applyDataset(impLabels, impData, impColours);
});

btnFreq.addEventListener('click', () => {
  if (btnFreq.classList.contains('active')) return;
  btnFreq.classList.add('active');
  btnImp.classList.remove('active');
  applyDataset(freqLabels, freqData, freqColours);
});
  </script>
  