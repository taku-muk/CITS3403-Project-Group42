<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Studio Clone ‚Äì Interactive Finance Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Papa Parse 5.x ‚Äì tiny, no build-step required -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style type="text/tailwindcss">
    /* Hover effect for editable cells */
    td:hover { @apply bg-[#2a2a2a] cursor-pointer; }
  
    /* Tag dropdown container */
    .tag-editor {
      @apply bg-[#1e1e1e] border border-[#333] p-2 rounded-lg absolute z-10 shadow-lg;
    }
  
    .tag-option {
      @apply px-2 py-1 rounded-full mb-1 text-sm select-none inline-block;
    }
    .tag-option.unselected { @apply bg-gray-700 text-gray-300; }
    .tag-option.selected   { @apply bg-purple-600 text-white; }
  
    .tag-popup {
  @apply absolute bg-[#1e1e1e] border border-[#333] rounded-lg
         p-3 flex flex-col justify-start items-start gap-2
         text-sm text-gray-300 h-auto;
  top: 100%;
  left: 0;
  margin-top: 0.5rem;
  z-index: 20;
}

  
    /* Pills */
  /* Pills */
.tag-pill {
  @apply inline-block text-xs px-2 py-1 rounded-full mr-1 mb-1 border; /* add border base */
}

/* darker bg + lighter text + matching outline */
.tag-pill.Need {
  @apply bg-green-700 text-green-300 border-green-300;
}
.tag-pill.Want {
  @apply bg-yellow-700 text-yellow-300 border-yellow-300;
}
.tag-pill.Essential {
  @apply bg-purple-700 text-purple-300 border-purple-300;
}
.tag-pill.Recurring {
  @apply bg-indigo-700 text-indigo-300 border-indigo-300;
}
.tag-pill.Once\-off {
  @apply bg-orange-700 text-orange-300 border-orange-300;
}


  </style>
  
  
</head>




<body class="bg-[#151515] text-white min-h-screen flex items-center justify-center">

<main class="w-full max-w-3xl px-6 space-y-10">
  <!-- Header -->
  <div>
    <h1 class="text-5xl font-bold">Let‚Äôs track your finances.</h1>
    <p class="text-2xl text-gray-400 mt-2">Start by adding your income and expenses below.</p>
  </div>

<!-- Action Buttons -->
<div class="bg-[#1e1e1e] rounded-full border border-[#333] px-6 py-4 flex items-center gap-4">
  <button
    id="manualBtn"
    class="bg-[#2a2a2a] px-4 py-2 rounded-full text-sm flex items-center gap-2"
  >
    <span>Ôºã</span> Manually input
  </button>

  <button
    class="bg-[#2a2a2a] px-4 py-2 rounded-full text-sm flex items-center gap-2"
  >
    <span>‚òÅÔ∏è</span> Import
  </button>

  <!-- arrow button at the end -->
  <button
  id="visualizeBtn"
  class="ml-auto bg-blue-500 hover:bg-blue-600 text-white w-10 h-10 flex items-center justify-center rounded text-xl font-bold transition"
>
  ‚Üí
</button>


</div>


  <!-- Table Section -->
  <!-- hide by default -->
<div
id="transactionsSection"
class="hidden bg-[#1e1e1e] p-6 rounded-xl border border-[#333]"
>
<div class="flex justify-between items-center mb-4">
  <h2 class="text-lg font-semibold text-gray-200">Transactions</h2>
  <button
    id="addTransactionBtn"
    class="bg-white text-black px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 shadow-sm hover:bg-gray-100 transition"
  >
    <span>Ôºã</span> Add
  </button>
</div>

<div class="overflow-x-auto">
  <table class="w-full text-left text-sm text-gray-300">
    <thead>
      <tr class="border-b border-[#333] text-gray-500">
        <th class="py-2 pr-4">Name</th>
        <th class="py-2 pr-4">Type</th>
        <th class="py-2 pr-4">Amount</th>
        <th class="py-2">Tags</th>
      </tr>
    </thead>
    <tbody id="transactionTableBody">
      <!-- Table starts empty -->
    </tbody>
  </table>
</div>
</div>

<!-- Import Section -->
<div
id="importSection"
class="hidden bg-[#1e1e1e] p-6 rounded-xl border border-[#333]"
>
<!-- Inside your importSection -->
<div
  id="dropzone"
  class="flex flex-col items-center justify-center min-h-[200px] border-2 border-dashed border-gray-500 rounded-xl p-8 text-gray-400 text-center cursor-pointer transition"
>
  <p class="text-lg">üìÑ Drag and drop your CSV file here</p>
  <p class="text-sm mt-2">or click to browse</p>
  <input id="fileInput" type="file" accept=".csv" class="hidden" />
</div>


</div>



  

</main>

<script>
  const TAGS = ['Need', 'Want', 'Essential'];
  const addTransactionBtn = document.getElementById('addTransactionBtn');
  const manualBtn           = document.getElementById('manualBtn');
  const tableBody = document.getElementById('transactionTableBody');
  const transactionsSection   = document.getElementById('transactionsSection');
  const importBtn = document.querySelector('#manualBtn').nextElementSibling; // finds the Import button
  const importSection = document.getElementById('importSection');


// Show the table when ‚ÄúManually input‚Äù is clicked and hide the import 
manualBtn.addEventListener('click', () => {
  transactionsSection.classList.remove('hidden');
  importSection.classList.add('hidden');
});


// show the import and hide the manual 
importBtn.addEventListener('click', () => {
  transactionsSection.classList.add('hidden');
  importSection.classList.remove('hidden');
});


  // Make a cell editable by turning it into an input
  function makeEditable(td) {
  td.addEventListener('click', () => {
    // don‚Äôt open twice
    if (td.dataset.editing === '1') return;
    td.dataset.editing = '1';

    /* remember the original classes (they contain the padding) */
    const originalClass = td.className;

    /* temporarily drop the padding so height/width stay identical */
    td.className = 'p-0';

    /* build the input */
    const old = td.textContent.trim();
    const input = document.createElement('input');
    input.type = 'text';
    input.value = old === '\u00A0' ? '' : old;

    /* exactly fill the cell, no extra space */
    input.className =
      'bg-transparent text-white outline-none w-full h-full box-border';

    /* swap the content */
    td.innerHTML = '';
    td.appendChild(input);
    input.focus();

    const finish = () => {
      const val = input.value.trim() || '\u00A0';
      td.textContent = val;

      /* restore the original padding / classes */
      td.className = originalClass;
      delete td.dataset.editing;
    };

    input.addEventListener('blur', finish);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') input.blur();
    });
  });
}

  // Show a Notion-like tag picker
 // define your layers up front
const TAG_CATEGORIES = [
  {
    key: 'frequency',
    label: 'Frequency',
    single: true,
    options: ['Recurring', 'Once-off']
  },
  {
    key: 'importance',
    label: 'Importance',
    single: false,
    options: ['Need', 'Want', 'Essential']
  }
];

function makeTagEditable(td) {
  td.addEventListener('click', event => {
    event.stopPropagation();
    // don‚Äôt re-open if one is already showing
    if (document.body.querySelector('.tag-popup')) return;

    // read existing selections (if any)
    const existing = td.dataset.tags
      ? JSON.parse(td.dataset.tags)
      : {};

    // compute cell position
    const rect = td.getBoundingClientRect();
    const popup = document.createElement('div');
    popup.className = 'tag-popup';
    // base styles (you can move these into your CSS)
    Object.assign(popup.style, {
      position: 'absolute',
      top: rect.bottom + window.scrollY + 'px',
      left: rect.left + window.scrollX + 'px',
      width: '14rem',
      background: '#1e1e1e',
      border: '1px solid #333',
      borderRadius: '0.5rem',
      padding: '0.75rem',
      zIndex: 9999
    });

    // build each category section
    TAG_CATEGORIES.forEach(cat => {
      // heading
      const h = document.createElement('div');
      h.textContent = cat.label;
      h.className = 'text-sm font-semibold mb-1 text-gray-200';
      popup.appendChild(h);

      // container for buttons
      const cont = document.createElement('div');
      cont.className = 'flex flex-wrap gap-2 mb-3';

      cat.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = opt;
        btn.dataset.cat = cat.key;
        btn.dataset.val = opt;
        btn.className = 'px-2 py-1 rounded-full text-sm border';

        // initialize selected state
        const sel = existing[cat.key] || [];
        const isSelected = cat.single
          ? sel === opt
          : sel.includes(opt);
        if (isSelected) {
          btn.classList.add('bg-purple-600', 'text-white');
        } else {
          btn.classList.add('bg-gray-700', 'text-gray-300');
        }

        btn.addEventListener('click', e => {
          e.stopPropagation();
          let cur = existing[cat.key] || (cat.single ? '' : []);
          if (cat.single) {
            // single-select: clear old
            existing[cat.key] = opt;
            // update visuals
            cont.querySelectorAll('button').forEach(b => {
              b.classList.toggle('bg-purple-600', b === btn);
              b.classList.toggle('text-white', b === btn);
              b.classList.toggle('bg-gray-700', b !== btn);
              b.classList.toggle('text-gray-300', b !== btn);
            });
          } else {
            // multi-select: toggle in array
            if (!Array.isArray(cur)) cur = [];
            if (cur.includes(opt)) {
              cur = cur.filter(x => x !== opt);
              btn.classList.replace('bg-purple-600','bg-gray-700');
              btn.classList.replace('text-white','text-gray-300');
            } else {
              cur.push(opt);
              btn.classList.replace('bg-gray-700','bg-purple-600');
              btn.classList.replace('text-gray-300','text-white');
            }
            existing[cat.key] = cur;
          }
        });

        cont.appendChild(btn);
      });

      popup.appendChild(cont);
    });

    document.body.appendChild(popup);

    // click-away to close & save
    function close(e) {
      if (!popup.contains(e.target)) {
        // serialize into cell text and dataset
        // clear out the cell‚Ä¶
td.innerHTML = '';
td.dataset.tags = JSON.stringify(existing);

// render frequency (if any) as a pill
if (existing.frequency) {
  const f = document.createElement('span');
  f.textContent = existing.frequency;
  f.className = 'tag-pill ' + existing.frequency;
  td.appendChild(f);
}

// render each importance tag as its own pill
(existing.importance || []).forEach(tag => {
  const p = document.createElement('span');
  p.textContent = tag;
  p.className = 'tag-pill ' + tag;
  td.appendChild(p);
});

        document.body.removeChild(popup);
        document.removeEventListener('click', close);
      }
    }
    setTimeout(() => document.addEventListener('click', close), 0);
  });
}


  // Add a blank row with min-height cells
  addTransactionBtn.addEventListener('click', () => {
    // show the table container if it was hidden
     transactionsSection.classList.remove('hidden');
    const row = document.createElement('tr');
    row.className = 'border-b border-[#2a2a2a]';

    ['name', 'type', 'amount', 'tags'].forEach((col, i) => {
      const td = document.createElement('td');
      td.className = 'py-2 pr-4 min-h-[3rem]';
      td.innerHTML = '¬†';  // non-breaking space keeps height
      if (col === 'tags') {
        td.className = 'py-2 min-h-[3rem]';
        makeTagEditable(td);
      } else {
        makeEditable(td);
      }
      row.appendChild(td);
    });

    tableBody.appendChild(row);
  });
</script>
<script type="module">
  import { setupImportArea } from "/static/js/import.js";

  window.addEventListener("DOMContentLoaded", () => {
    setupImportArea("dropzone");
  });
</script>


</body>

</html>
